# 操作系统基础（混合式）

> 整理：[@BlockLune](https://github.com/BlockLune) 协议：[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)

成绩组成：40% 平时 + 60% 期末

## 第一章

### 操作系统的定义（P3）

现代操作系统是计算机系统中最为基本的一种系统软件，它是程序模块的集合。操作系统能够以尽量有效、合理的方式组织和管理计算机的软、硬件资源，合理地组织计算机的工作流程，控制程序的执行，并能够向用户提供各种服务功能，使计算机系统能够高效地运行，还能够改善人机界面，以使用户能够灵活、方便、有效地应用计算机。

以上定义包含了如下三个层次：

1. 操作系统是整个计算机系统的管理者，所有的资源都归操作系统管理。
2. 操作系统能够控制程序的执行，并且向用户提供服务功能，为计算机系统中运行的各种应用程序提供有效的支撑；程序可以有效地利用系统的资源，程序和程序之间不能互相干扰。
3. 操作系统提供的人机界面一定是友好的，应该为用户提供方便的执行操作命令行或图形化界面，同时要为程序员提供多样化的编程接口，以便有效地基于操作系统来进行开发。

### 操作系统的特性（P5 - P7）

1. 并发性。这是指两个或两个以上的事件 / 活动在同一时间间隔内发生。其包括宏观和微观两个层面：宏观上，多个程序在计算机系统内同时执行；微观上，任何时刻只有一个程序在 CPU 上运行。
2. 共享性。计算机系统中的资源可被多个并发执行的用户程序和系统程序共同使用。共享形式可以分为顺序性共享和竞争性共享两种形式，前者即轮流使用，后者表示竞争式地使用资源。
3. 不确定性。又称异步性、随机性，体现为系统中的事件发生具有随机性和不确定性。在多道程序并发执行的环境中，各程序之间存在着直接或间接的联系，程序的推进速度会受到运行环境的影响。系统中许多随机性事件打断了正在执行的程序，因此，在程序的执行过程中就产生了不确定性的因素。
4. 虚拟性。这是指在物理上没有提供，在逻辑上却具备的功能，在用户看来好像是物理上原来就具有的功能一样。采用虚拟技术的目的是提高资源利用率和为用户提供易于使用、方便高效的操作环境。操作系统中的虚拟化技术，可以把物理上的一个资源实体（如 CPU）逻辑上的多个对应物，或者把物理上的多个实体变成逻辑上的一个对应物。

现代操作系统的 4 个特性不是相互独立的，而是彼此密切关联的。

- 并发和共享是操作系统的两个最基本特征，它们有时互为存在的条件。
- 虚拟技术为共享提供了更好的条件，而并发和共享是导致不确定性的根本原因。

### 操作系统的种类

1. 桌面操作系统
    - Windows系列（Windows 10/11等）
    - macOS
    - Linux发行版（Ubuntu、Fedora、CentOS等）
2. 移动操作系统
    - Android（Google）
    - iOS（Apple）
    - HarmonyOS（华为）
3. 服务器操作系统
    - Windows Server
    - Linux服务器版本（Red Hat、Ubuntu Server等）
    - Unix系统（如IBM AIX、HP-UX等）
4. 嵌入式操作系统
    - Linux嵌入式版本
    - Windows IoT
    - QNX
    - VxWorks
5. 实时操作系统（RTOS）
    - FreeRTOS
    - QNX
    - VxWorks
    - RT-Thread

## 第二章

### 进程的定义（P17）

进程是具有独立功能的程序关于某个数据集合上的一次运行活动，是系统进行资源分配、调度和保护的独立单位。

### 进程的类型（P17）

- 系统进程：操作系统自身的模块、程序在计算机系统中运行时系统为它们创建的进程
- 用户进程：用户的应用程序在计算机系统中运行时创建的进程

### 进程的结构（P17）

~~程序、数据、进程控制块、栈~~

程序代码、数据、进程控制块、堆栈

### 进程的特性（P17）

1. 结构性。进程由程序、数据、进程控制块、栈构成。
2. 共享性。多个进程在系统中共享各种资源，包括 CPU、内存、I/O 设备、数据文件等。
3. 动态性。进程在系统中有诞生、有消亡，是动态变化的。进程的整个生命周期体现出动态性特征。
4. 独立性。系统中并发运行的多个进程是独立运行的，分别使用分给它们的相应资源，按照自己的逻辑往前推进和执行。
5. 制约性。多个进程在系统中并发运行时，既可能彼此写作，也可能彼此竞争，体现了制约性。
6. 并发性。多个进程在系统中并发运行，分时、分空间地使用 CPU 和内存等资源，并发地向前推进。

### 进程和程序的区别（P18）

1. 进程能真实地描述系统中的并发特征，程序不能。
2. 进程是由程序、数据、进程控制块、栈等部分构成的，程序其实是进程的一部分。
3. 程序本质是代码集合，是静态的，而进程是一次活动，在不同状态之间切换，体现出动态性的特征。
4. 进程是有生命周期的，有诞生、有消亡，相对来讲比较短暂；而程序可以保存在辅存上，长久存在。
5. 一个程序在系统中可以演化为多个进程，而一个进程可以涉及多个程序。这时，进程和程序不再仅仅是一一对应的关系，也可能是一对多，还可能是多对一的关系。
6. 进程可以创建子进程，程序不能创建子程序。

### 进程状态（P18）

#### 最基本的三态

- 运行态：进程正在 CPU 上运行，即正在执行指令。
- 就绪态：进程已经准备好要到 CPU 上运行了，但是因为某些原因（例如 CPU 上其他程序正在执行）不能切换到运行状态。
- 等待态：又称阻塞态、封锁态、睡眠态。进程正在等待某事件发生，抑或是等待某信号、某种资源，但那个事件尚未完成。等到那个事件完成了，就会转变为就绪态。

运行和就绪态可以相互转换；运行可以转换为等待；等待可以转换成就绪。

#### 进程的五态模型

除了最基本的三态，再加上两个状态：

- 新建态：进程刚刚创建，但系统还没有允许它执行，而且它所需的一些资源还没有完全被满足。一旦这些资源得到了满足，它就会转变为就绪态。
- 终止态：进程正常结束或异常终止即进入该状态。此时的进程不再具有执行权限。待操作系统进一步处理后，该状态的进程就会被删除。

#### 进程的七态模型

在五态模型的基础上再加上两个状态。但首先，应先了解一下 “挂起” 的概念。

“挂起” 指的是，当系统资源（尤其是内存资源）无法满足当前系统中所有进程的需求时，必须将某些进程的程序、数据等内容迁移到辅存的镜像区中，暂时不参与调度，以将这些进程原来占有的内存资源释放出来供其他进程使用。

挂起的逆操作是激活。

下面是新增的两种状态：

- 就绪挂起态：在进程的就绪态被挂起
- 等待挂起态：在进程的等待态被挂起

### 处理器调度（P24）

#### 模式

- 低级调度（进程调度）：处理器资源。就绪、等待、运行
- 中级调度（平衡负载调度）：内存资源。挂起、激活
- 高级调度（作业调度）：创建和终止进程（从无到有、从有到无）

#### 指标

周转时间：
$$
T_{周转}=T_{完成}-T_{到达}
$$

带权周转时间：
$$
T_{带权周转}=T_{周转} / T_{执行}
$$

平均周转时间：
$$
T_{平均周转} = T_{周转} / 任务数
$$

平均带权周转时间：
$$
T_{平均带权周转} = T_{带权周转} / 任务数
$$

#### 单道、多道

...



### 进程的同步和互斥（P37）

同步是指多个进程之间为完成共同任务而相互协调执行次序的过程。

互斥是指多个进程在同一时刻只能有一个进程访问共享资源。

实现方法主要包括：

1. 信号量机制（参考[《信号量小书》](https://blog.csdn.net/booksyhay/article/details/82692362)）
2. 互斥锁
3. 管程
4. 条件变量
5. 事件机制

### 死锁

死锁是指系统中两个或两个以上进程无限期地永远等待永远不会满足的条件，永远在等待着永远得不到的资源而处于停滞状态。（P62）

死锁产生的**必要**条件（注意是 “必要”，即即使 4 个条件都满足，死锁也不一定产生）（P64）：

1. 互斥使用
2. 不可抢占
3. 请求和保持
4. 循环等待

死锁的预防（P64）：

1. 破坏 “不可抢占” 条件
2. 破坏 “请求和保持” 条件
3. 破坏 “循环等待” 条件

死锁的避免（P65）：在系统运行前不做硬性规定，在系统运行过程中再对进程的每一次资源申请进行动态检查，并根据检查结果来决定是否分配。

死锁的检测和解决（P68）：允许死锁的产生（比起预防和避免，产生的系统开销较低）。但是操作系统要不断监视系统的进展情况，判断当前是不是确实有死锁产生。一旦死锁确实产生了，系统就要采取专门的措施来解除死锁，并恢复系统的运行。

### 银行家算法

参考 [操作系统原理期末速成不挂科主攻大题 - 银行家算法（BV1qd4y177eA）](https://www.bilibili.com/video/BV1qd4y177eA/?p=6)



## 第三章

### 内存

### 连续式（P80）

单道顺序环境下，内存一分为二（操作系统区和用户区），由栅栏寄存器用于存放界限地址。

### 分区式（P81）

进一步将用户区划分为多个区域，每个区域一个进程。

- 固定分区（优点：简单、容易实现；缺点：内存利用率低、不够灵活）
  - 等长分区
  - 不等长分区：内存分区表（分区号、起始地址、长度、状态、进程号）
- 可变分区（优点：灵活度更高；缺点：实现复杂，存在内存碎片问题）
  - 空闲区表 + 已分配区表

### 分页式（P86）

进程的逻辑地址空间按**固定大小**分为若干页面，不足一页补齐一页。常见页面大小包括 4KB、8KB、16 KB 等。

在存储时，逻辑上相邻的页面在物理存储时不一定是相邻的。

基本原理、页表、地址转换

置换（P96）、计算缺页率

优点：解决了内存碎片问题，便于管理内存；缺点：不易实现内容共享，特别是代码共享，不便于动态连接（P93）

### 分段式（P90）

概念...

优点：适合代码共享、数据共享，便于动态连接；缺点：继承了可变分区存储中的碎片问题（P93）

### 段页式（P93）

将上述分页和分段结合起来：按逻辑关系划分用户程序为若干逻辑段，再按分页存储管理机制划分和分配内存。



## 第四章

### 设备控制方式（P105）

- 询问方式：CPU 启动 I/O 设备，并反复检测其是否就绪（即所谓 “询问”）
- 基于中断：I/O 设备通过终端来主动报告自身状态
- 基于 DMA：DMA 控制器来负责数据的传输过程，作为 CPU 的助手，传输完成后再通知 CPU
- 基于通道：通道又称 “输入输出控制器”，将完成传输文件的整个过程（相较之下，DMA 以数据块为单位，在每个数据块的传输开始前和结束后，都需要 CPU 的参与，而通道不需要）

### 缓冲技术（P107）

单缓冲、双缓冲、循环缓冲、缓冲池等

- 改善主机与 I/O 设备之间速度不匹配的问题
- 提高 CPU 与 I/O 设备的并行性，提高资源利用率
- 减少 I/O 中断次数，放宽对 CPU 中断响应的要求

### 外存储（P109）

访问磁盘上的数据，依赖于：（P110）

- 柱面号 / 磁道号：数据位于哪个半径的磁道上（磁道是同心圆，磁道号从 0 开始由外到内减小）
- 磁头号 / 盘面号：数据位于哪个盘面上
- 块号 / 扇区号：数据位于某磁道的哪一个扇区（扇区是磁道同心圆上的一块区域）

磁盘的数据访问时间包括：（P110）

- 寻道时间：磁头移动到指定磁道上所经过的时间 
  $$
  T = T_{磁头臂启动时间} + T_{移动一条磁道} \times 磁道数
  $$

- 旋转延迟时间：磁头已经定位到磁道，等待扇区移动到磁头下方的时间

- 数据传输时间：磁头定位到扇区后，从磁盘读取或向磁盘写入数据所花的时间

磁头臂驱动算法：（P111）

- 先来先
- 最短查找时间优先：可能导致饿死
- 电梯：沿当前运动方向，选择距磁头驱动臂移动方向最近的柱面，如果没有访问请求，才改变移动方向
- 扫描：与电梯的区别在于，扫描会将磁头移动到最大 / 最小磁道
- 单向扫描：非来回扫描
- ~~分步扫描~~：（不考）

## 第五章

位示图（P117）

### 文件目录结构（P119）

一级、二级、多级

### 文件物理结构（P120）

顺序文件结构：

- 将逻辑上连续的文件信息存放在存储介质内依次**相邻**的物理块上
- 记录信息：文件名、始址、块数
- 插入删除开销大

链接文件结构：

- 将在逻辑上连续的文件信息存放在不连续的物理块上。在每个物理块中设一个指针指向下一个物理块
- 读取性能低于顺序文件结构，但在插入删除方面有优势

索引文件结构：

- 将逻辑上连续的文件信息存放在不连续的物理块上，并为每个文件建立索引表
- 记录信息：文件名、索引表地址、索引表内容（逻辑块号与物理块号的对应关系）
- 与链接文件结构类似，扩展性好。但是索引表较大，占用空间，且检索速度下降。可采用多级索引来做取舍。

## 补充

（这里是原来资料漏掉的，后来补充的内容）

临界区：有空让进、无空等待、多种择一、有限等待
